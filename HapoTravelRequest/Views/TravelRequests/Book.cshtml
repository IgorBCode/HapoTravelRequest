@model HapoTravelRequest.Models.TravelRequest.TravelRequestBookVM

@{
    ViewData["Title"] = "Travel Request Details";
}

<h2 class="page-title">Travel Request Details</h2>

<form asp-controller="TravelRequests" method="post">
    <input type="hidden" name="id" value="@Model.Id" />
    <input type="hidden" name="redirectAction" value="ViewTravelRequests" />
    <input type="hidden" name="redirectController" value="TravelRequests" />

    <div class="accordion" id="detailsAccordion">

        <!-- Employee Information -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingEmployee">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEmployee" aria-expanded="true" aria-controls="collapseEmployee">
                    Employee Information
                </button>
            </h2>
            <div id="collapseEmployee" class="accordion-collapse collapse show" aria-labelledby="headingEmployee">
                <div class="accordion-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-item"><strong>First Name:</strong> @Model.FirstName</div>
                            <div class="info-item"><strong>Last Name:</strong> @Model.LastName</div>
                            <div class="info-item"><strong>Date of Birth:</strong> @Model.DateOfBirth.ToShortDateString()</div>
                            <div class="info-item"><strong>Phone Number:</strong> @Model.PhoneNumber</div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-item"><strong>Department:</strong> @Model.Department</div>
                            <div class="info-item"><strong>Position Title:</strong> @Model.PositionTitle</div>
                            <div class="info-item"><strong>Department Director:</strong> @Model.DepartmentDirector</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Conference and Travel Information -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingConference">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseConference" aria-expanded="true" aria-controls="collapseConference">
                    Conference and Travel Information
                </button>
            </h2>
            <div id="collapseConference" class="accordion-collapse collapse show" aria-labelledby="headingConference">
                <div class="accordion-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-item"><strong>Purpose of Travel:</strong> @Model.PurposeOfTravel</div>
                            <div class="info-item"><strong>Conference Description:</strong> @Model.ConferenceDescription</div>
                            <div class="info-item"><strong>Conference Link:</strong> @Model.ConferenceLink</div>
                            <div class="info-item"><strong>Alternative Text:</strong> @Model.AlternativeText</div>
                            <div class="info-item"><strong>Location:</strong> @Model.Location</div>
                            <div class="info-item"><strong>Non-Employee Guests:</strong> @(Model.NonEmployeeGuests ? "Yes" : "No")</div>
                            <div class="info-item"><strong>Guest Name:</strong> @Model.NonEmployeeLegalName</div>
                            <div class="info-item"><strong>Guest DOB:</strong> @Model.NonEmployeeDOB?.ToShortDateString()</div>
                            <div class="info-item"><strong>Employees Attending:</strong> @Model.EmployeesAttending</div>
                            <div class="info-item"><strong>Employee Names:</strong> @Model.EmployeesAttendingNames</div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-item"><strong>Emergency Contact:</strong> @Model.EmergencyContactname</div>
                            <div class="info-item"><strong>Emergency Contact Phone:</strong> @Model.EmergencyContactPhoneNumber</div>
                            <div class="info-item"><strong>TSA Number:</strong> @Model.TSANumber</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Book Travel (Input Fields) -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingBookTravel">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBookTravel" aria-expanded="true" aria-controls="collapseBookTravel">
                    Book Travel
                </button>
            </h2>
            <div id="collapseBookTravel" class="accordion-collapse collapse show" aria-labelledby="headingBookTravel">
                <div class="accordion-body">
                    <div class="row">
                        <div class="col-md-6">
                            @* Left Side Inputs *@
                            <div class="mb-3">
                                <label asp-for="CostOfConference" class="form-label"></label>
                                <input asp-for="CostOfConference" class="form-control" />
                                <span asp-validation-for="CostOfConference" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label asp-for="ConferenceStartDate" class="form-label"></label>
                                <input asp-for="ConferenceStartDate" class="form-control" placeholder="mm/dd/yyyy" />
                                <span asp-validation-for="ConferenceStartDate" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label asp-for="ConferenceEndDate" class="form-label"></label>
                                <input asp-for="ConferenceEndDate" class="form-control" placeholder="mm/dd/yyyy" />
                                <span asp-validation-for="ConferenceEndDate" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label asp-for="DepartureDate" class="form-label"></label>
                                <input asp-for="DepartureDate" class="form-control" placeholder="mm/dd/yyyy" />
                                <span asp-validation-for="DepartureDate" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label asp-for="ReturnDate" class="form-label"></label>
                                <input asp-for="ReturnDate" class="form-control" placeholder="mm/dd/yyyy" />
                                <span asp-validation-for="ReturnDate" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="col-md-6">
                            @* Right Side Inputs *@
                            <div class="mb-3">
                                <label asp-for="ConferenceHotelName" class="form-label"></label>
                                <input asp-for="ConferenceHotelName" class="form-control" />
                                <span asp-validation-for="ConferenceHotelName" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label asp-for="TransportationMode" class="form-label"></label>
                                <input asp-for="TransportationMode" class="form-control" />
                                <span asp-validation-for="TransportationMode" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label asp-for="AirlineDetails" class="form-label"></label>
                                <textarea asp-for="AirlineDetails" class="form-control"></textarea>
                                <span asp-validation-for="AirlineDetails" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label asp-for="FlightCost" class="form-label"></label>
                                <input asp-for="FlightCost" class="form-control" />
                                <span asp-validation-for="FlightCost" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label asp-for="GroundTransportation" class="form-label"></label>
                                <input asp-for="GroundTransportation" class="form-control" />
                                <span asp-validation-for="GroundTransportation" class="text-danger"></span>
                            </div>
                            <div class="mb-3">
                                <label asp-for="GroundOptions" class="form-label"></label>
                                <input asp-for="GroundOptions" class="form-control" />
                                <span asp-validation-for="GroundOptions" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    @* Radio buttons section (below 2 columns) *@
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <div class="form-check mb-2">
                                <label>Registered For Conference</label><br />
                                <input type="radio" asp-for="RegisteredForConference" value="true" /> Yes
                                <input type="radio" asp-for="RegisteredForConference" value="false" /> No
                            </div>
                            <div class="form-check mb-2">
                                <label>Registered?</label><br />
                                <input type="radio" asp-for="Registered" value="true" /> Yes
                                <input type="radio" asp-for="Registered" value="false" /> No
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Sticky Action Bar -->
    <div class="sticky-action-bar">
        <button type="submit" asp-action="Book" class="custom-btn-yellow me-2">Submit</button>
        <button type="submit" asp-action="Cancel" class="btn btn-danger">Cancel Request</button>
    </div>
</form>

<div class="page-bottom-buffer"></div>

<!-- Comments Section -->
<div class="accordion mt-5" id="commentsAccordion">
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingComments">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseComments" aria-expanded="true" aria-controls="collapseComments">
                Comments
            </button>
        </h2>
        <div id="collapseComments" class="accordion-collapse collapse show" aria-labelledby="headingComments">
            <div class="accordion-body">
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div id="comments-container"></div>
                        <form asp-action="AddComment" method="post" class="my-4" id="add-comment-form">
                            <input type="hidden" asp-for="Id" />
                            <div class="form-group">
                                <label asp-for="NewComment" class="control-label"></label>
                                <textarea asp-for="NewComment" class="form-control" rows="4"></textarea>
                                <span asp-validation-for="NewComment" class="text-danger"></span>
                            </div>
                            <button type="submit" class="custom-btn-yellow mt-2 mb-4">Submit Comment</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function loadComments() {
            var travelRequestId = $('input[name="Id"]').val();
            $.get('@Url.Action("GetComments", "TravelRequests")', { id: travelRequestId }, function (data) {
                $('#comments-container').hide().html(data).fadeIn(400);
            });
        }

        $(document).ready(function () {
            loadComments();

            $('#add-comment-form').submit(function (e) {
                e.preventDefault();
                var form = $(this);

                $.post(form.attr('action'), form.serialize(), function () {
                    form[0].reset();
                    loadComments();
                });
            });
        });
    </script>
}

<style>
    .accordion-button {
        background-color: #FFDC32;
        color: #212529;
        font-weight: bold;
    }
    .accordion-button:not(.collapsed) {
        background-color: #FFDC32;
        color: #212529;
    }
    .info-item {
        margin-bottom: 0.75rem;
    }
    .page-title {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 1.5rem;
    }
    .page-bottom-buffer {
        height: 100px;
    }
</style>
