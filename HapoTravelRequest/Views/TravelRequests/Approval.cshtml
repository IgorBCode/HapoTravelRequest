@model HapoTravelRequest.Models.TravelRequest.TravelRequestReadOnlyVM

@{
    ViewData["Title"] = "Travel Request Details";
}

<!-- Approve/Deny Buttons -->
<form asp-action="ApproveOrDeny" method="post" class="sticky-action-bar">
    <input type="hidden" name="id" value="@Model.Id" />
    <input type="hidden" name="redirectAction" value="ViewTravelRequests" />
    <input type="hidden" name="redirectController" value="TravelRequests" />
    <button type="submit" name="decision" value="approve" class="custom-btn-yellow">Approve</button>
    <button type="submit" name="decision" value="deny" class="btn btn-danger">Deny</button>
</form>

<h2 class="page-title">Travel Request Details</h2>

<div class="accordion" id="detailsAccordion">
    <!-- Employee Information -->
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingEmployee">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEmployee" aria-expanded="true" aria-controls="collapseEmployee">
                Employee Information
            </button>
        </h2>
        <div id="collapseEmployee" class="accordion-collapse collapse show" aria-labelledby="headingEmployee">
            <div class="accordion-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="info-item"><strong>First Name:</strong> @Model.FirstName</div>
                        <div class="info-item"><strong>Last Name:</strong> @Model.LastName</div>
                        <div class="info-item"><strong>Date of Birth:</strong> @Model.DateOfBirth.ToShortDateString()</div>
                        <div class="info-item"><strong>Phone Number:</strong> @Model.PhoneNumber</div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-item"><strong>Department:</strong> @Model.Department</div>
                        <div class="info-item"><strong>Position Title:</strong> @Model.PositionTitle</div>
                        <div class="info-item"><strong>Department Director:</strong> @Model.DepartmentDirector</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Conference and Travel Information -->
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingConference">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseConference" aria-expanded="true" aria-controls="collapseConference">
                Conference and Travel Information
            </button>
        </h2>
        <div id="collapseConference" class="accordion-collapse collapse show" aria-labelledby="headingConference">
            <div class="accordion-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="info-item"><strong>Purpose of Travel:</strong> @Model.PurposeOfTravel</div>
                        <div class="info-item"><strong>Conference Description:</strong> @Model.ConferenceDescription</div>
                        <div class="info-item"><strong>Conference Link:</strong> @Model.ConferenceLink</div>
                        <div class="info-item"><strong>Alternative Text:</strong> @Model.AlternativeText</div>
                        <div class="info-item"><strong>Location:</strong> @Model.Location</div>
                        <div class="info-item"><strong>Cost:</strong> @(Model.CostOfConference.HasValue ? $"${Model.CostOfConference.Value.ToString("0.00")}" : "Unknown")</div>
                        <div class="info-item"><strong>Conference Start:</strong> @Model.ConferenceStartDate.ToShortDateString()</div>
                        <div class="info-item"><strong>Conference End:</strong> @Model.ConferenceEndDate.ToShortDateString()</div>
                        <div class="info-item"><strong>Registration Deadline:</strong> @Model.RegistrationDeadline?.ToShortDateString()</div>
                        <div class="info-item"><strong>Departure Date:</strong> @Model.DepartureDate?.ToShortDateString()</div>
                        <div class="info-item"><strong>Return Date:</strong> @Model.ReturnDate?.ToShortDateString()</div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-item"><strong>Employees Attending:</strong> @Model.EmployeesAttending</div>
                        <div class="info-item"><strong>Employee Names:</strong> @Model.EmployeesAttendingNames</div>
                        <div class="info-item"><strong>Non-Employee Guests:</strong> @(Model.NonEmployeeGuests ? "Yes" : "No")</div>
                        <div class="info-item"><strong>Guest Name:</strong> @Model.NonEmployeeLegalName</div>
                        <div class="info-item"><strong>Guest DOB:</strong> @Model.NonEmployeeDOB?.ToShortDateString()</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Transportation and Lodging -->
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingTransport">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTransport" aria-expanded="true" aria-controls="collapseTransport">
                Transportation and Lodging
            </button>
        </h2>
        <div id="collapseTransport" class="accordion-collapse collapse show" aria-labelledby="headingTransport">
            <div class="accordion-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="info-item"><strong>Transportation Mode:</strong> @Model.TransportationMode</div>
                        <div class="info-item"><strong>Airline Details:</strong> @Model.AirlineDetails</div>
                        <div class="info-item"><strong>Flight Cost:</strong> $@Model.FlightCost</div>
                        <div class="info-item"><strong>Ground Transportation:</strong> @Model.GroundTransportation</div>
                        <div class="info-item"><strong>Ground Options:</strong> @Model.GroundOptions</div>
                        <div class="info-item"><strong>TSA Number:</strong> @Model.TSANumber</div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-item"><strong>Conference Hotel:</strong> @Model.ConferenceHotelName</div>
                        <div class="info-item"><strong>Preferred Lodging Info:</strong> @Model.PreferredLodgingInfo</div>
                        <div class="info-item"><strong>Special Travel Request:</strong> @Model.SpecialTravelRequest</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reimbursements -->
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingReimbursements">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseReimbursements" aria-expanded="true" aria-controls="collapseReimbursements">
                Reimbursements
            </button>
        </h2>
        <div id="collapseReimbursements" class="accordion-collapse collapse show" aria-labelledby="headingReimbursements">
            <div class="accordion-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="info-item"><strong>Mileage Reimbursement:</strong> @(Model.MileageReimbursement ? "Yes" : "No")</div>
                        <div class="info-item"><strong>Round Trip Miles:</strong> @Model.MileageRoundTrip</div>
                        <div class="info-item"><strong>Meals & Incidentals:</strong> @(Model.MIE ? "Yes" : "No")</div>
                        <div class="info-item"><strong>Daily MIE Amount:</strong> $@Model.DailyMIEAmount</div>
                        <div class="info-item"><strong>Days for MIE:</strong> @Model.DaysForMIE</div>
                        <div class="info-item"><strong>Deposit Account:</strong> @Model.DepositAccount</div>
                        <div class="info-item"><strong>Account Type:</strong> @Model.AccountType</div>
                        <div class="info-item"><strong>Corporate Card:</strong> @(Model.CorporateCard ? "Yes" : "No")</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Emergency Contact -->
    <div class="accordion-item">
        <h2 class="accordion-header" id="headingEmergency">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEmergency" aria-expanded="true" aria-controls="collapseEmergency">
                Emergency Contact
            </button>
        </h2>
        <div id="collapseEmergency" class="accordion-collapse collapse show" aria-labelledby="headingEmergency">
            <div class="accordion-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="info-item"><strong>Contact Name:</strong> @Model.EmergencyContactName</div>
                        <div class="info-item"><strong>Contact Phone:</strong> @Model.EmergencyContactPhoneNumber</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Comments -->
    <div class="accordion-item mb-5">
        <h2 class="accordion-header" id="headingComments">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseComments" aria-expanded="true" aria-controls="collapseComments">
                Comments
            </button>
        </h2>
        <div id="collapseComments" class="accordion-collapse collapse show" aria-labelledby="headingComments">
            <div class="accordion-body">
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div id="comments-container"></div>
                        <form asp-action="AddComment" method="post" class="my-4" id="add-comment-form">
                            <input type="hidden" asp-for="Id" />
                            <div class="form-group">
                                <label asp-for="NewComment" class="control-label"></label>
                                <textarea asp-for="NewComment" class="form-control" rows="4"></textarea>
                                <span asp-validation-for="NewComment" class="text-danger"></span>
                            </div>
                            <button type="submit" class="custom-btn-yellow mt-2 mb-4">Submit Comment</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="page-bottom-buffer"></div>
@section Scripts {
    <script>
        function loadComments() {
            var travelRequestId = $('input[name="Id"]').val();
            $.get('@Url.Action("GetComments", "TravelRequests")', { id: travelRequestId }, function (data) {
                $('#comments-container').hide().html(data).fadeIn(400);
            });
        }

        $(document).ready(function () {
            loadComments();
            $('#add-comment-form').submit(function (e) {
                e.preventDefault();
                var form = $(this);
                $.post(form.attr('action'), form.serialize(), function () {
                    form[0].reset();
                    loadComments();
                });
            });
        });
    </script>
}

<style>
    .accordion-button {
        background-color: #FFDC32;
        color: #212529;
        font-weight: bold;
    }

    .info-item {
        margin-bottom: 0.75rem;
    }

    .page-title {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 1.5rem;
    }

    .page-bottom-buffer {
        height: 4rem;
    }
</style>
